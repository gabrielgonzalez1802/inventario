<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <title>Sistema Celulares</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" sizes="64x64" th:href="@{/img/icon.png}">
    <link rel="stylesheet" type="text/css" th:href="@{/bootstrap/css/bootstrap.min.css}">
	<link rel="stylesheet" type="text/css" th:href="@{/css/sticky-dark-top-nav.css}">
    <!-- Font-icon css-->
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300&display=swap" rel="stylesheet">
 	<link rel="stylesheet" type="text/css" th:href="@{/css/Minimal-tabs.css}">
 	<link href = "https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/css/select2.min.css" rel ="stylesheet"/>
 	<link rel="stylesheet" type="text/css" th:href="@{/css/dashboard.css}">
 	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300&display=swap" rel="stylesheet">
 	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
 	<link rel="stylesheet" type="text/css" th:href="@{/css/swal.css}">
  </head>
  <body>
     <span th:insert="fragments/topMenu :: menu-principal"></span> 
     <br>
	<div class="container">
		<div class="card all">
			<div class="card-body" style="margin-top: 0px;">
			   <h4 class="card-header"><strong style="color: #fff;">Datos del Art&iacute;culo</strong><a th:href="@{/articulos/}" style="float: right;" class="btn btn-md btn-primary">Regresar</a></h4>              
				<br>

		<form method="post" th:object="${articulo}" th:action="@{/articulos/save}" id="formAddProduct" enctype="multipart/form-data" autocomplete="off">       
             <input type="hidden" th:field="*{imagen}">
              <div class="row">
                <div class="col-md-5"> 
                  <div class="form-group">
                    <label for="nombre">Nombre</label>
                    <input type="text" th:field="*{nombre}" class="form-control" id="nombre" required="required" placeholder="Nombre">
                  </div>
                </div>
                 <div class="col-md-2"> 
                  <div class="form-group">
                    <label for="codigo">C&oacute;digo</label>
                    <input type="text" th:field="*{codigo}" class="form-control" id="codigo" placeholder="C&oacute;digo">
                  </div>
                </div>
                <div class="col-md-3"> 
                  <div class="form-group">
                    <label for="codigo_barras">C&oacute;digo de barras</label>
                    <input type="text" class="form-control" th:field="*{codigo_barras}" id="codigo_barras" placeholder="C&oacute;digo de barras">
                  </div>
                </div>

                 <div class="col-md-2"> 
                  <div class="form-group">
                    <label for="fecha">Costo</label>
                    <input type="number" min="0" class="form-control" th:field="*{costo}" id="costo" placeholder="Costo" required="required">
                  </div>  
                </div>
              </div>
              
              <hr id="hrPrice" style="border-top: 1px solid #D8D8D8;">
                 
              <div class="row">
                <div class="col-md-2"> 
                  <div class="form-group">
                    <label for="precio_maximo" id="lbl_precio_maximo">Precio M&aacute;ximo</label>
                    <input type="text" th:field="*{precio_maximo}" class="form-control" id="precio_maximo" placeholder="Precio M&aacute;ximo">
                  </div>  
                </div>
                 <div class="col-md-1"> 
                  <div class="form-group">
                    <label for="min_precio_maximo" id="lbl_min_precio_maximo">Min</label>
                    <input type="number" th:field="*{rango_precio_maximo_desde}" class="form-control" min = "0" id="min_precio_maximo">
                  </div>  
                </div>
                 <div class="col-md-1"> 
                  <div class="form-group">
                    <label for="max_precio_maximo" id="lbl_max_precio_maximo">Max</label>
                    <input type="number" th:field="*{rango_precio_maximo_hasta}"  class="form-control" min = "0" id="max_precio_maximo">
                  </div>  
                </div>
                 <div class="col-md-2"> 
                  <div class="form-group">
                    <label for="precio_minimo" id="lbl_precio_minimo">Precio Minimo</label>
                    <input type="text" class="form-control" th:field="*{precio_minimo}" id="precio_minimo" placeholder="Precio Minimo">
                  </div>  
                </div>
                 <div class="col-md-1"> 
                  <div class="form-group">
                    <label for="min_precio_minimo" id="lbl_min_precio_minimo">Min</label>
                    <input type="number" class="form-control" th:field="*{rango_precio_minimo_desde}" min = "0" id="min_precio_minimo">
                  </div>  
                </div>
                 <div class="col-md-1"> 
                  <div class="form-group">
                    <label for="max_precio_minimo" id="lbl_max_precio_minimo">Max</label>
                    <input type="number" th:field="*{rango_precio_minimo_hasta}" class="form-control" min = "0" id="max_precio_minimo">
                  </div>  
                </div>
                <div class="col-md-2"> 
                  <div class="form-group">
                    <label for="precio_mayor" id="lbl_precio_mayor">Precio x Mayor</label>
                    <input type="text" class="form-control" th:field="*{precio_mayor}" id="precio_mayor" placeholder="Precio x Mayor">
                  </div>  
                </div>
                <div class="col-md-1"> 
                  <div class="form-group">
                    <label for="min_precio_mayor" id="lbl_min_precio_mayor">Min</label>
                    <input type="number" th:field="*{rango_precio_mayor_desde}" class="form-control" min = "0" id="min_precio_mayor">
                  </div>  
                </div>
                 <div class="col-md-1"> 
                  <div class="form-group">
                    <label for="max_precio_mayor" id="lbl_max_precio_mayor">Max</label>
                    <input type="number" th:field="*{rango_precio_mayor_hasta}" class="form-control" min = "0" id="max_precio_mayor">
                  </div>  
                </div>
              </div>    
            
              <hr style="border-top: 1px solid #D8D8D8;">
              
              <div class="row">
             	 <div class="col-md-3"> 
                  <div class="form-group">
                    <label for="imei">Imei</label>
                   	<select class="form-control" th:field="*{imei}" id="imei">
					  <option value="SI">Si</option>
                      <option value="NO">No</option>
                    </select>
                  </div>  
                </div>
                <div class="col-md-3">
                  <div class="form-group">
                    <label for="itbis">Itbis</label>
                    <select class="form-control" th:field="*{itbis}" id="itbis">
					  <option value="SI">Si</option>
                      <option value="NO">No</option>
                    </select>
                  </div>
                </div>
               <div class="col-md-3"> 
                  <div class="form-group">
                    <label for="gama" id="lblGama">Gama</label>
                     <select class="form-control" th:field="*{gama}" id="gama">
					  <option value="BAJA">baja</option>
                      <option value="MEDIA">media</option>
                      <option value="ALTA">alta</option>
                    </select>
                  </div>  
                </div>
                <div class="col-md-3"> 
                  <div class="form-group">
                    <label for="imagen">Imagen</label>
                     <input type="file" class="form-control-file" name="archivoImagen" id="archivoImagen">
                  </div>
                </div>
              </div> 
              
              <hr style="border-top: 1px solid #D8D8D8;">
             
              <div class="row">
                <div class="col-md-3">
                  <label for="imagen">Imagen/Logo</label>
                  <img th:src="@{/img/no-image.png}" class="rounded mx-auto d-block" alt="Generic placeholder image" width="150" height="150">            
                </div>
                <div class="col-md-3"> 
                  <div class="form-group">
                    <label for="categoria">Categor&iacute;a</label>
                    <select class="form-control"  th:field="*{categoria.id}" id="categoria">
                   		 <option th:fragment="listaCategorias" 
                   		 th:each="cat : ${listaCategorias}" 
                   		 th:value="${cat.id}" 
                   		 th:text="${cat.nombre}" />
                    </select>
                  </div>                  
                </div>
                 <div class="col-md-3">
                  <div class="form-group">
                  		 <br>
                		 <button type="button" id="btnModalAddCategory" data-toggle="tooltip" data-placement="top" title="Crear Categor&iacute;a" class="btn btn-lg btn-primary"> + </button>
                	</div>   
                </div>                
                
              </div> 
              <input type="submit" class="btn btn-lg btn-primary" value="Guardar"> 
            </form>	
			</div>
			<a class="card-link" href="#"></a>
		</div>	
		
		<!-- Modal Catogory -->
		<div class="modal fade" id="modalAddCategory" tabindex="-1" role="dialog"
			aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content all">
					<div class="modal-header">
						<h5 class="modal-title" id="exampleModalLabel" style="color: #ffff;">Nueva Categor&iacute;a</h5>
						<button type="button" class="close" data-dismiss="modal"
							aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<form>
							<div class="form-group">
								<label for="nameCategory" class="col-form-label">Nombre de la Categor&iacute;a:</label>
								<input type="text" class="form-control" id="nameCategory">
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary"
							data-dismiss="modal" id="closeCategoryModal">Cerrar</button>
						<button type="button" id="guardarCategoria" class="btn btn-primary">Guardar</button>
					</div>
				</div>
			</div>
		</div>


	</div>

	<script th:src="@{/js/jquery.min.js}"></script>
    <script th:src="@{/bootstrap/js/bootstrap.min.js}"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.min.js"></script>
	<span th:if="${msg != null}" class="alert alert-success" role="alert">
		<script type="text/javascript">
		Swal.fire({
			  title: 'Muy bien!',
			  text: 'Registro guardado',
			  icon: 'success',
			  confirmButtonText: 'Cool'
			})
		</script>
	</span>
	<span th:if="${msg2 != null}" class="alert alert-success" role="alert">
		<script type="text/javascript">
		Swal.fire({
			  title: 'Muy bien!',
			  text: 'Registro Modificado',
			  icon: 'success',
			  confirmButtonText: 'Cool'
			})
		</script>
	</span>
	<script type="text/javascript">
		$('#categoria').load("/categorias/ajax/getAll");
		
		//validacion para los input de precios cuando sea un articulo con serial
		if($("#imei").val()=="SI"){
			ocultarPrecios();
		}
		
		function ocultarPrecios(){
			$("#precio_mayor").val("0");
			$('#precio_mayor').removeAttr('required');
			$("#min_precio_mayor").val("0");
			$('#min_precio_mayor').removeAttr('required');
			$("#max_precio_mayor").val("0");
			$('#max_precio_mayor').removeAttr('required');

			$("#precio_maximo").val("0");
			$('#precio_maximo').removeAttr('required');
			$("#min_precio_maximo").val("0");
			$('#min_precio_maximo').removeAttr('required');
			$("#max_precio_maximo").val("0");	
			$('#max_precio_maximo').removeAttr('required');
	
			$("#precio_minimo").val("0");
			$('#precio_minimo').removeAttr('required');
			$("#min_precio_minimo").val("0");
			$('#min_precio_minimo').removeAttr('required');
			$("#max_precio_minimo").val("0");	
			$('#max_precio_minimo').removeAttr('required');
			
			$("#precio_mayor").hide();
			$("#min_precio_mayor").hide();
			$("#max_precio_mayor").hide();
			
			$("#precio_maximo").hide();
			$("#min_precio_maximo").hide();
			$("#max_precio_maximo").hide();
			
			$("#precio_minimo").hide();
			$("#min_precio_minimo").hide();
			$("#max_precio_minimo").hide();
			
			//labels
			$("#lbl_precio_maximo").hide();
			$("#lbl_min_precio_maximo").hide();
			$("#lbl_max_precio_maximo").hide();
			$("#lbl_precio_minimo").hide();
			$("#lbl_min_precio_minimo").hide();
			$("#lbl_max_precio_minimo").hide();
			$("#lbl_precio_mayor").hide();
			$("#lbl_min_precio_mayor").hide();
			$("#lbl_max_precio_mayor").hide();
			
			//hr
			$("#hrPrice").hide();
		}
		
		$("#imei").change(function(){
			if($("#imei").val()=="NO"){
				mostrarPrecios();
				$("#lblGama").hide();
				$("#gama").hide();
			}else{
				ocultarPrecios();
				$("#lblGama").show();
				$("#gama").show();
			}
		});
		
		function mostrarPrecios(){
			$("#precio_mayor").val("0");
			$('#precio_mayor').prop('required',true);
			$("#min_precio_mayor").val("0");
			$('#min_precio_mayor').prop('required',true);
			$("#max_precio_mayor").val("0");
			$('#max_precio_mayor').prop('required',true);

			$("#precio_maximo").val("0");
			$('#precio_maximo').prop('required',true);
			$("#min_precio_maximo").val("0");
			$('#min_precio_maximo').prop('required',true);
			$("#max_precio_maximo").val("0");	
			$('#max_precio_maximo').prop('required',true);
	
			$("#precio_minimo").val("0");
			$('#precio_minimo').prop('required',true);
			$("#min_precio_minimo").val("0");
			$('#min_precio_minimo').prop('required',true);
			$("#max_precio_minimo").val("0");	
			$('#max_precio_minimo').prop('required',true);
			
			$("#precio_mayor").show();
			$("#min_precio_mayor").show();
			$("#max_precio_mayor").show();
			
			$("#precio_maximo").show();
			$("#min_precio_maximo").show();
			$("#max_precio_maximo").show();
			
			$("#precio_minimo").show();
			$("#min_precio_minimo").show();
			$("#max_precio_minimo").show();
			
			//labels
			$("#lbl_precio_maximo").show();
			$("#lbl_min_precio_maximo").show();
			$("#lbl_max_precio_maximo").show();
			$("#lbl_precio_minimo").show();
			$("#lbl_min_precio_minimo").show();
			$("#lbl_max_precio_minimo").show();
			$("#lbl_precio_mayor").show();
			$("#lbl_min_precio_mayor").show();
			$("#lbl_max_precio_mayor").show();
			
			//hr
			$("#hrPrice").show();
		}
		
		$("#btnModalAddCategory").click(function(){
			$('#modalAddCategory').modal('show');
		});
		
		$("#closeCategoryModal").click(function(){
			$('#nameCategory').val('');
		});
		
		$("#guardarCategoria").click(function(){
			var categoria = $("#nameCategory").val();
			var url = "/categorias/ajax/create/"+categoria;
			$('#categoria').load(url,function(){
				$('#modalAddCategory').modal('hide');
			});
		});
		
   		 var _mSelect2 = $("#js-example-basic-multiple").select2();

			//Validacion before submit
   		   $("#formAddProduct").submit(function() {
   			//Vaidacion: el costo no puede ser mayor a ningún precio de venta
   				var costo = parseFloat($("#costo").val());
   				
   				if($("#imei").val()=="NO"){
   	   				var precio_mayor = parseFloat($("#precio_mayor").val());
   	   				var precio_maximo = parseFloat($("#precio_maximo").val());
   	   				var precio_minimo = parseFloat($("#precio_minimo").val());
   	   	   			if(costo>precio_mayor || costo>precio_maximo || costo>precio_minimo){
   	   	   				Swal.fire({
   	   	   					  title: 'Alerta!',
   	   	   					  text: 'El costo no puede ser mayor a ningun precio de venta',
   	   	   					  icon: 'warning',
   	   	   					  confirmButtonText: 'Entendido'
   	   	   					})
   	   	   				return false;	
   	   	   			}else{
   	   	   				return true;
   	   	   			}	
   				}else{
   					return true;
   				}
	   		});
	</script>
	 <span th:insert="fragments/footer :: footer"></span>  
</body>
</html>